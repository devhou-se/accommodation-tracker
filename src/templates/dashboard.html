<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPOT HUNTER</title>
    <link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0a0a0a;
            color: #ffffff;
            overflow-x: hidden;
            min-height: 100vh;
        }

        /* Animated background */
        .bg-grid {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0.03;
            background-image: 
                linear-gradient(rgba(255,255,255,.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(255,255,255,.1) 1px, transparent 1px);
            background-size: 50px 50px;
            animation: grid-move 20s linear infinite;
            z-index: -2;
        }

        @keyframes grid-move {
            0% { transform: translate(0, 0); }
            100% { transform: translate(50px, 50px); }
        }

        /* Glowing orbs */
        .bg-orb {
            position: fixed;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.4;
            z-index: -1;
            animation: float 6s ease-in-out infinite;
        }

        .orb-1 {
            width: 300px;
            height: 300px;
            background: linear-gradient(45deg, #00ff87, #00d4ff);
            top: 10%;
            left: 20%;
            animation-delay: 0s;
        }

        .orb-2 {
            width: 200px;
            height: 200px;
            background: linear-gradient(45deg, #ff006e, #8338ec);
            top: 60%;
            right: 15%;
            animation-delay: 2s;
        }

        .orb-3 {
            width: 250px;
            height: 250px;
            background: linear-gradient(45deg, #ffbe0b, #fb5607);
            bottom: 20%;
            left: 60%;
            animation-delay: 4s;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            33% { transform: translateY(-20px) rotate(120deg); }
            66% { transform: translateY(-10px) rotate(240deg); }
        }

        /* Main container */
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
            z-index: 1;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 60px;
            padding: 40px 0;
        }

        .logo {
            font-family: 'JetBrains Mono', monospace;
            font-size: 3.5rem;
            font-weight: 700;
            background: linear-gradient(45deg, #00ff87, #00d4ff, #8338ec, #ff006e);
            background-size: 300% 300%;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            animation: gradient-shift 3s ease infinite;
            text-transform: uppercase;
            letter-spacing: 4px;
            margin-bottom: 10px;
        }

        @keyframes gradient-shift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .tagline {
            font-size: 1.1rem;
            color: #888;
            font-weight: 300;
            letter-spacing: 1px;
        }

        /* Status grid */
        .spots-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 30px;
            margin-bottom: 60px;
        }

        .spot-card {
            background: rgba(20, 20, 20, 0.8);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 30px;
            position: relative;
            overflow: hidden;
            transition: all 0.4s ease;
            backdrop-filter: blur(20px);
        }

        .spot-card:hover {
            transform: translateY(-10px);
            border-color: rgba(0, 255, 135, 0.5);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.4),
                0 0 40px rgba(0, 255, 135, 0.1);
        }

        .spot-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00ff87, #00d4ff);
            opacity: 0;
            transition: opacity 0.4s ease;
        }

        .spot-card:hover::before {
            opacity: 1;
        }

        .spot-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .spot-type {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            font-weight: 600;
        }

        .sumo { color: #ff006e; }
        .ryokan { color: #00ff87; }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            animation: pulse-dot 2s infinite;
        }

        .status-active { background: #00ff87; }
        .status-checking { background: #ffbe0b; }
        .status-error { background: #ff006e; }

        @keyframes pulse-dot {
            0% { opacity: 1; box-shadow: 0 0 0 0 currentColor; }
            70% { opacity: 0.7; box-shadow: 0 0 0 10px transparent; }
            100% { opacity: 1; box-shadow: 0 0 0 0 transparent; }
        }

        .spot-title {
            font-size: 1.4rem;
            font-weight: 600;
            margin-bottom: 15px;
            line-height: 1.3;
        }

        .spot-meta {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
            font-size: 0.9rem;
            color: #aaa;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .hunt-btn {
            background: linear-gradient(45deg, #00ff87, #00d4ff);
            color: #000;
            border: none;
            border-radius: 50px;
            padding: 12px 24px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
            position: relative;
            overflow: hidden;
        }

        .hunt-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 10px 30px rgba(0, 255, 135, 0.3);
        }

        .hunt-btn:active {
            transform: scale(0.98);
        }

        .hunt-btn.hunting {
            background: linear-gradient(45deg, #ffbe0b, #fb5607);
            pointer-events: none;
        }

        /* Activity feed */
        .activity-section {
            margin-top: 60px;
        }

        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .activity-feed {
            background: rgba(15, 15, 15, 0.8);
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            overflow: hidden;
        }

        .activity-item {
            padding: 25px 30px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            display: flex;
            flex-direction: column;
            gap: 15px;
            transition: background 0.3s ease;
        }

        .activity-item:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .activity-item:last-child {
            border-bottom: none;
        }

        .activity-time {
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.8rem;
            color: #666;
            min-width: 60px;
        }

        .activity-header {
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .activity-content {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .availability-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 12px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.08);
        }
        
        .availability-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .activity-title {
            font-weight: 500;
            color: #fff;
        }

        .availability-tag {
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }
        
        .venue-details {
            font-size: 0.8rem;
            color: #ccc;
            font-weight: 400;
            line-height: 1.3;
        }
        
        .venue-name {
            font-weight: 500;
            color: #fff;
        }
        
        .room-type {
            color: #aaa;
        }
        
        .booking-date {
            color: #10b981;
            font-weight: 500;
        }

        .tag-available {
            background: rgba(0, 255, 135, 0.2);
            color: #00ff87;
            border: 1px solid rgba(0, 255, 135, 0.3);
        }

        .tag-limited {
            background: rgba(255, 190, 11, 0.2);
            color: #ffbe0b;
            border: 1px solid rgba(255, 190, 11, 0.3);
        }

        .tag-sold-out {
            background: rgba(255, 0, 110, 0.2);
            color: #ff006e;
            border: 1px solid rgba(255, 0, 110, 0.3);
        }

        .book-link {
            background: linear-gradient(45deg, #00ff87, #00d4ff);
            color: #000;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .book-link:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 255, 135, 0.3);
        }

        /* Loading states */
        .loading-shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            background-size: 200% 100%;
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .logo {
                font-size: 2.5rem;
                letter-spacing: 2px;
            }
            
            .spots-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .spot-card {
                padding: 20px;
            }
            
            .activity-item {
                padding: 20px;
                gap: 10px;
            }
            
            .activity-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }
            
            .activity-time {
                min-width: auto;
                font-size: 0.7rem;
            }
        }

        /* Scroll animations */
        .fade-in {
            animation: fadeIn 0.8s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>
    <div class="bg-grid"></div>
    <div class="bg-orb orb-1"></div>
    <div class="bg-orb orb-2"></div>
    <div class="bg-orb orb-3"></div>
    
    <div class="container">
        <header class="header fade-in">
            <h1 class="logo">SPOT HUNTER</h1>
            <p class="tagline">Real-time availability tracking for exclusive experiences</p>
        </header>

        <div class="spots-grid">
            {% for plugin in plugin_status %}
            <div class="spot-card fade-in">
                <div class="spot-header">
                    <span class="spot-type {{ 'sumo' if 'sumo' in plugin.name else 'ryokan' }}">
                        {% if 'sumo' in plugin.name %}SUMO{% else %}RYOKAN{% endif %}
                    </span>
                    <div class="status-dot {{ 'status-active' if plugin.last_success else ('status-error' if plugin.last_check else 'status-checking') }}"></div>
                </div>
                
                <h3 class="spot-title">
                    {% if 'sumo' in plugin.name %}
                        {{ plugin.event_info.name }}
                    {% elif 'direct_booking' in plugin.name %}
                        Traditional Shirakawa Ryokans
                    {% else %}
                        {{ plugin.event_info.name }}
                    {% endif %}
                </h3>
                
                <div class="spot-meta">
                    <div class="meta-item">
                        <span>‚ö°</span>
                        <span>{{ plugin.check_interval_minutes }}m</span>
                    </div>
                    {% if plugin.last_check %}
                    <div class="meta-item">
                        <span>üïê</span>
                        <span>{{ (plugin.last_check|to_jst).strftime('%H:%M JST') }}</span>
                    </div>
                    {% endif %}
                    {% if 'direct_booking' in plugin.name %}
                    <div class="meta-item">
                        <span>üè†</span>
                        <span>{{ plugin.event_info.venues|length }} spots</span>
                    </div>
                    {% endif %}
                </div>
                
                <button class="hunt-btn" onclick="huntSpot('{{ plugin.name }}', this)">
                    HUNT NOW
                </button>
            </div>
            {% endfor %}
        </div>

        <div class="activity-section">
            <h2 class="section-title">
                <span>‚ö°</span>
                RECENT ACTIVITY
            </h2>
            
            <div class="activity-feed" id="activity-feed">
                {% for result in recent_results %}
                <div class="activity-item">
                    <div class="activity-header">
                        <div class="activity-time">{{ (result.check_time|to_jst).strftime('%H:%M JST') }}</div>
                        <div class="activity-title">
                            {% if 'sumo' in result.plugin_name %}
                                ü•ã {{ result.item_name }}
                            {% elif 'direct_booking' in result.plugin_name %}
                                üè† Traditional Shirakawa Ryokans
                            {% else %}
                                üìç {{ result.item_name }}
                            {% endif %}
                        </div>
                    </div>
                    
                    {% if result.success and result.availabilities %}
                    <div class="activity-content">
                        {% for availability in result.availabilities[:3] %}
                            <div class="availability-item">
                                <div class="availability-info">
                                    <div class="availability-tag {{ 'tag-available' if availability.status == 'available' else ('tag-limited' if availability.status == 'limited' else 'tag-sold-out') }}">
                                        {% if availability.status == 'available' %}AVAILABLE{% elif availability.status == 'limited' %}LIMITED{% else %}SOLD OUT{% endif %}
                                    </div>
                                    <div class="venue-details">
                                        {% if availability.venue and availability.venue != result.item_name %}
                                            <span class="venue-name">{{ availability.venue }}</span>
                                        {% endif %}
                                        {% if availability.room_type %}
                                            {% if availability.venue and availability.venue != result.item_name %} - {% endif %}
                                            <span class="room-type">{{ availability.room_type }}</span>
                                        {% endif %}
                                        {% if availability.date %}
                                            - <span class="booking-date">{{ availability.date }}</span>
                                        {% endif %}
                                    </div>
                                </div>
                                {% if availability.booking_url %}
                                    <a href="{{ availability.booking_url }}" target="_blank" class="book-link">BOOK</a>
                                {% endif %}
                            </div>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <script>
        function huntSpot(pluginName, button) {
            const originalText = button.textContent;
            button.textContent = 'HUNTING...';
            button.classList.add('hunting');
            
            fetch(`/api/check/${pluginName}`, { method: 'POST' })
                .then(response => response.json())
                .then(data => {
                    // Show success effect
                    button.textContent = 'FOUND!';
                    setTimeout(() => {
                        refreshActivity();
                        button.textContent = originalText;
                        button.classList.remove('hunting');
                    }, 1500);
                })
                .catch(error => {
                    console.error('Hunt failed:', error);
                    button.textContent = 'RETRY';
                    setTimeout(() => {
                        button.textContent = originalText;
                        button.classList.remove('hunting');
                    }, 2000);
                });
        }
        
        function refreshActivity() {
            fetch('/api/results?limit=10')
                .then(response => response.json())
                .then(data => {
                    updateActivityFeed(data);
                })
                .catch(error => console.error('Refresh failed:', error));
        }
        
        function updateActivityFeed(results) {
            const feed = document.getElementById('activity-feed');
            feed.innerHTML = '';
            
            results.forEach(result => {
                const item = document.createElement('div');
                item.className = 'activity-item';
                
                const timeStr = new Date(result.check_time).toLocaleTimeString('en-US', {
                    timeZone: 'Asia/Tokyo',
                    hour12: false,
                    hour: '2-digit',
                    minute: '2-digit'
                }) + ' JST';
                
                const typeIcon = result.plugin_name.includes('sumo') ? 'ü•ã' : 'üè†';
                const displayName = result.plugin_name.includes('sumo') ? result.item_name : 
                                  result.plugin_name.includes('direct_booking') ? 'Traditional Shirakawa Ryokans' : 
                                  result.item_name;
                const availabilitiesHtml = result.success && result.availabilities ? 
                    `<div class="activity-content">` + 
                    result.availabilities.slice(0, 3).map(a => {
                        const statusClass = a.status === 'available' ? 'tag-available' : 
                                          a.status === 'limited' ? 'tag-limited' : 'tag-sold-out';
                        const statusText = a.status === 'available' ? 'AVAILABLE' : 
                                         a.status === 'limited' ? 'LIMITED' : 'SOLD OUT';
                        const venueText = a.venue && a.venue !== result.item_name ? `<span class="venue-name">${a.venue}</span>` : '';
                        const roomText = a.seat_type ? `${venueText ? ' - ' : ''}<span class="room-type">${a.seat_type}</span>` : '';
                        const dateText = a.date ? ` - <span class="booking-date">${a.date}</span>` : '';
                        const bookLink = a.booking_url ? `<a href="${a.booking_url}" target="_blank" class="book-link">BOOK</a>` : '';
                        return `
                            <div class="availability-item">
                                <div class="availability-info">
                                    <div class="availability-tag ${statusClass}">${statusText}</div>
                                    <div class="venue-details">
                                        ${venueText}${roomText}${dateText}
                                    </div>
                                </div>
                                ${bookLink}
                            </div>
                        `;
                    }).join('') + `</div>` : '';
                
                item.innerHTML = `
                    <div class="activity-header">
                        <div class="activity-time">${timeStr}</div>
                        <div class="activity-title">${typeIcon} ${displayName}</div>
                    </div>
                    ${availabilitiesHtml}
                `;
                
                feed.appendChild(item);
            });
        }
        
        // Auto-refresh every 30 seconds
        setInterval(refreshActivity, 30000);
        
        // Add loading animations
        document.addEventListener('DOMContentLoaded', function() {
            const cards = document.querySelectorAll('.spot-card');
            cards.forEach((card, index) => {
                setTimeout(() => {
                    card.style.opacity = '1';
                }, index * 200);
            });
        });
    </script>
</body>
</html>